import matplotlib.pyplot
import numpy
import pandas
import scipy.stats as stats


def remove_out(
        dataframe,
        rev_range: float,
) -> pandas.Series:
    """
    https://lifelong-education-dr-kim.tistory.com/entry/python-pandas-series-type%EC%97%90%EC%84%9C-%EC%9D%B4%EC%83%81%EC%B9%98-outlier-%EC%A0%9C%EA%B1%B0-%ED%95%98%EA%B8%B0
    :param dataframe:
    :return:
    """
    dff: pandas.Series = pandas.Series(dataframe)
    level_1q = dff.quantile(0.25)
    level_3q = dff.quantile(0.75)
    IQR = level_3q - level_1q

    dff = dff[(dff <= level_3q + (rev_range * IQR)) & (dff >= level_1q - (rev_range * IQR))]
    dff = dff.reset_index(drop=True)
    return dff


def main(
        data: dict[str, list],
        # rev_range: float = 6.0,  # 제거 범위 조절 변수. 낮으면 낮을수록 더 많이 제거함.
        rev_range: float = 3.0,  # 제거 범위 조절 변수. 낮으면 낮을수록 더 많이 제거함.
):
    # pd_series = pandas.Series(data["little-no-outlier"])
    # pd_series = pandas.Series(data["little-outlier"])
    # pd_series = pandas.Series(data["many-no-outlier"])
    pd_series = pandas.Series(data["many-outlier"])
    print(pd_series)

    out = remove_out(pd_series, rev_range)
    print(out)

    data2 = out.to_list()

    pdf = stats.norm.pdf(
        numpy.sort(data2),
        numpy.mean(data2),
        numpy.std(data2),
    )

    matplotlib.pyplot.figure()
    matplotlib.pyplot.plot(numpy.sort(data2), pdf)
    matplotlib.pyplot.show()


if __name__ == '__main__':
    # 건수가 적고 아웃라이어가 있는 경우
    data: dict[str, list] = {
        "little-no-outlier": [
            35289,
            35065,
            32773,
            31203,
            27494,
            26585,
            26284,
            25974,
            25974,
            25824,
            25134,
            25134,
            24828,
            23606,
            23532,
            23422,
            23300,
            23300,
            23300,
            22918,
            22911,
            22765,
            22613,
            22460,
            22078,
            21008,
            20850,
            20717,
            20690,
            20626,
            20550,
            20550,
            20530,
            20244,
            20048,
            19786,
            19411,
            19300,
            19099,
            17722,
            17714,
        ],
        "little-outlier": [
            750556,
            209112,
            209112,
            209112,
            209112,
            209112,
            209112,
            209112,
            209112,
            209112,
            209112,
            209112,
            209112,
            209112,
            183861,
            182888,
            181359,
            175423,
            175423,
            175423,
            175423,
            175423,
            175423,
            175423,
            175423,
            175423,
            175423,
            175423,
            175423,
            175423,
            175423,
            175423,
            175423,
            175423,
            175342,
            159587,
            151261,
            135218,
            134915,
            134915,
            124808,
            113063,
            110008,
            105348,
            101597,
            100076,
            97134,
            95111,
            93965,
            90909,
            90845,
            83270,
            68257,
            67249,
        ],
        "many-no-outlier": [
            16893,
            15638,
            15271,
            15214,
            15205,
            15129,
            15129,
            14960,
            14790,
            14790,
            14366,
            14358,
            14282,
            14282,
            14197,
            14112,
            14070,
            14027,
            13943,
            13943,
            13943,
            13943,
            13943,
            13943,
            13934,
            13773,
            13688,
            13519,
            13519,
            13519,
            13434,
            13434,
            13434,
            13434,
            13434,
            13434,
            13434,
            13434,
            13349,
            13349,
            13349,
            13349,
            13349,
            13349,
            13349,
            13265,
            13265,
            13265,
            13265,
            13265,
            13261,
            13180,
            13108,
            13108,
            13095,
            13095,
            13095,
            13095,
            13010,
            13010,
            12897,
            12869,
            12869,
            12869,
            12869,
            12869,
            12869,
            12822,
            12784,
            12775,
            12745,
            12745,
            12699,
            12614,
            12614,
            12614,
            12606,
            12591,
            12530,
            12530,
            12530,
            12530,
            12530,
            12530,
            12530,
            12516,
            12445,
            12445,
            12445,
            12445,
            12363,
            12360,
            12360,
            12360,
            12360,
            12360,
            12275,
            12275,
            12191,
            12191,
            12191,
            12191,
            12191,
            12191,
            12147,
            12133,
            12106,
            12106,
            12106,
            12097,
            12070,
            12058,
            12056,
            12056,
            12021,
            12021,
            12021,
            12021,
            12021,
            12021,
            11981,
            11981,
            11981,
            11917,
            11879,
            11879,
            11879,
            11879,
            11879,
            11879,
            11879,
            11879,
            11808,
            11772,
            11770,
            11710,
            11710,
            11710,
            11710,
            11701,
            11701,
            11701,
            11701,
            11695,
            11695,
            11656,
            11625,
            11625,
            11625,
            11625,
            11625,
            11625,
            11619,
            11612,
            11540,
            11540,
            11540,
            11456,
            11456,
            11456,
            11390,
            11390,
            11383,
            11313,
            11286,
            11286,
            11286,
            11286,
            11286,
            11278,
            11201,
            11201,
            11201,
            11185,
            11154,
            11117,
            11117,
            11084,
            11077,
            11077,
            11077,
            11032,
            10931,
            10891,
            10848,
            10848,
            10806,
            10806,
            10806,
            10722,
            10722,
            10722,
            10722,
            10722,
            10722,
            10695,
            10646,
            10646,
            10637,
            10637,
            10619,
            10619,
            10570,
            10542,
            10468,
            10468,
            10417,
            10390,
            10383,
            10383,
            10374,
            10298,
            10290,
            10213,
            10129,
            10129,
            9958,
            9902,
            9902,
            9817,
            9817,
            9809,
            9724,
            9648,
            9549,
            9518,
            9478,
            9470,
            9470,
            9470,
            9470,
            9470,
            9470,
            9394,
            9309,
            9061,
            9055,
            8799,
            8744,
            8660,
            8600,
            8600,
            8600,
            8600,
            8600,
            8600,
            8600,
            8600,
            8500,
            8500,
            8500,
            8300,
            8200,
            7572,
            7417,
            7390,
            7005,
        ],
        "many-outlier": [
            89049,
            37448,
            28105,
            24012,
            23923,
            23121,
            22766,
            22232,
            22078,
            21964,
            21608,
            21431,
            21342,
            21075,
            21008,
            20986,
            20550,
            20532,
            20452,
            20363,
            20214,
            20096,
            20096,
            20096,
            19786,
            19651,
            19651,
            19651,
            19562,
            19562,
            19562,
            19562,
            19562,
            19562,
            19500,
            19385,
            19328,
            19327,
            19318,
            19246,
            19206,
            19206,
            19206,
            18869,
            18851,
            18762,
            18752,
            18583,
            18583,
            18494,
            18487,
            18444,
            18444,
            18335,
            18317,
            18317,
            18317,
            18317,
            18283,
            18258,
            18105,
            18050,
            17961,
            17953,
            17871,
            17800,
            17782,
            17782,
            17782,
            17782,
            17782,
            17722,
            17694,
            17694,
            17647,
            17605,
            17605,
            17605,
            17571,
            17563,
            17426,
            17426,
            17426,
            17426,
            17418,
            17321,
            17321,
            17160,
            17160,
            17112,
            16982,
            16982,
            16973,
            16893,
            16893,
            16893,
            16893,
            16893,
            16893,
            16893,
            16883,
            16799,
            16730,
            16714,
            16714,
            16714,
            16626,
            16537,
            16537,
            16537,
            16527,
            16519,
            16448,
            16444,
            16444,
            16425,
            16425,
            16358,
            16358,
            16341,
            16270,
            16092,
            16092,
            16083,
            16083,
            16074,
            16043,
            16035,
            16002,
            16002,
            16002,
            16002,
            16002,
            16002,
            16002,
            15966,
            15966,
            15966,
            15962,
            15962,
            15914,
            15914,
            15914,
            15890,
            15890,
            15890,
            15878,
            15825,
            15737,
            15737,
            15722,
            15722,
            15704,
            15704,
            15661,
            15661,
            15638,
            15638,
            15638,
            15638,
            15638,
            15638,
            15638,
            15638,
            15629,
            15629,
            15629,
            15508,
            15468,
            15468,
            15383,
            15299,
            15271,
            15214,
            15214,
            15214,
            15205,
            15205,
            15202,
            15171,
            15171,
            15129,
            15129,
            15129,
            15129,
            15044,
            15044,
            15044,
            15044,
            14960,
            14935,
            14897,
            14897,
            14897,
            14875,
            14875,
            14865,
            14859,
            14790,
            14790,
            14790,
            14790,
            14790,
            14790,
            14790,
            14790,
            14790,
            14790,
            14790,
            14782,
            14705,
            14621,
            14621,
            14621,
            14621,
            14621,
            14558,
            14536,
            14536,
            14536,
            14536,
            14515,
            14482,
            14482,
            14439,
            14439,
            14439,
            14407,
            14366,
            14366,
            14362,
            14358,
            14358,
            14282,
            14282,
            14254,
            14209,
            14197,
            14197,
            14197,
            14197,
            14197,
            14176,
            14125,
            14112,
            14112,
            14112,
            14027,
            14027,
            13948,
            13947,
            13943,
            13943,
            13943,
            13943,
            13904,
            13872,
            13858,
            13773,
            13773,
            13773,
            13773,
            13751,
            13743,
            13718,
            13688,
            13688,
            13688,
            13688,
            13675,
            13675,
            13604,
            13598,
            13566,
            13519,
            13519,
            13519,
            13519,
            13519,
            13510,
            13510,
            13510,
            13510,
            13434,
            13434,
            13434,
            13434,
            13434,
            13351,
            13349,
            13349,
            13349,
            13349,
            13349,
            13337,
            13293,
            13265,
            13216,
            13216,
            13216,
            13216,
            13180,
            13180,
            13180,
            13180,
            13095,
            13095,
            13095,
            13095,
            13095,
            13095,
            13095,
            13095,
            13095,
            13010,
            12987,
            12911,
            12897,
            12897,
            12869,
            12869,
            12869,
            12869,
            12869,
            12834,
            12820,
            12784,
            12758,
            12614,
            12614,
            12614,
            12606,
            12605,
            12591,
            12530,
            12530,
            12530,
            12452,
            12452,
            12445,
            12445,
            12445,
            12445,
            12445,
            12360,
            12201,
            12191,
            12182,
            12147,
            12133,
            12133,
            12133,
            12106,
            12021,
            12021,
            12021,
            11879,
            11879,
            11879,
            11847,
            11770,
            11710,
            11701,
            11701,
            11688,
            11625,
            11625,
            11625,
            11625,
            11625,
            11625,
            11617,
            11540,
            11456,
            11456,
            11350,
            11312,
            11286,
            11286,
            11286,
            11117,
            11077,
            10891,
            10806,
            10798,
            10798,
            10790,
            10722,
            10722,
            10722,
            10722,
            10722,
            10568,
            10552,
            10552,
            10492,
            10492,
            10492,
            10383,
            10383,
            10383,
            10298,
            10213,
            10129,
            10129,
            10129,
            9930,
            9894,
            9894,
            9817,
            9747,
            9733,
            9648,
            9648,
            9626,
            9549,
            9478,
            9478,
            9224,
            9224,
            9055,
            9046,
            9046,
            8914,
            8829,
            8744,
            8744,
            8684,
            8660,
            8599,
            8393,
            8156,
            8150,
            8066,
            7944,
            7750,
            7700,
            7698,
            7650,
            7615,
            7614,
            7367,
            6900,
            6739,
            6739,
            6689,
            6689,
            6423,
            6423,
            6300,
            6223,
            5918,
            5718,
        ]
    }
    main(data)
